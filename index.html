<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Chat</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#1e1e2f,#2c2c54);
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
}
header {
  padding:15px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  background:rgba(0,0,0,0.3);
}
#chat {
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.message {
  max-width:70%;
  margin:5px;
  padding:10px;
  border-radius:15px;
}
.sender {
  font-size:12px;
  opacity:0.7;
  margin-bottom:2px;
}
.mine {
  background:#4f46e5;
  align-self:flex-end;
}
.other {
  background:#2d2d44;
  align-self:flex-start;
}
#inputArea {
  display:flex;
  gap:5px;
  padding:10px;
  width:100%;
  background:rgba(0,0,0,0.3);
}
#messageInput {
  flex:1;
  padding:10px;
  border-radius:15px;
  border:none;
  outline:none;
}
button {
  padding:10px 15px;
  border:none;
  border-radius:12px;
  background:#6366f1;
  color:white;
  cursor:pointer;
}
</style>
</head>
<body>

<header>Simple Chat</header>

<div id="chat"></div>
<div id="inputArea">
  <input id="messageInput" placeholder="Type a message..." />
  <button id="sendBtn">Send</button>
</div>

<script type="module">
// ðŸ”‘ Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

// ðŸ”§ Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD9GQMi0v4ItnkJ2uqKtUUQU59DorLrCAg",
  authDomain: "live-chat-3d2c3.firebaseapp.com",
  projectId: "live-chat-3d2c3",
  storageBucket: "live-chat-3d2c3.firebasestorage.app",
  messagingSenderId: "550798266942",
  appId: "1:550798266942:web:2ce678f70e4f64d6f7376f",
  measurementId: "G-L0K72L8894"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();

// ðŸ”¹ Sign in anonymously
await signInAnonymously(auth);
console.log("Signed in anonymously!");

// Prompt for a name
let username = localStorage.getItem("chatUsername");
while(!username || username.trim().length < 1){
  username = prompt("Enter your name:");
}
username = username.trim();
localStorage.setItem("chatUsername", username);

// Elements
const chatDiv = document.getElementById("chat");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");

// Firestore collection
const messagesRef = collection(db,"messages");

// Send message function
async function sendMessage(){
  const text = messageInput.value.trim();
  if(!text) return;
  try {
    await addDoc(messagesRef,{
      text,
      sender: username,
      createdAt:serverTimestamp()
    });
    messageInput.value="";
  } catch(err){
    console.error("Error sending message:", err);
    alert("Failed to send message. Check console.");
  }
}

// Send on button click or Enter
sendBtn.addEventListener("click", sendMessage);
messageInput.addEventListener("keypress", e=>{
  if(e.key==="Enter") sendMessage();
});

// Real-time updates
const q = query(messagesRef, orderBy("createdAt"));
onSnapshot(q, snapshot=>{
  chatDiv.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "message "+(data.sender===username?"mine":"other");
    div.innerHTML = `<div class="sender">${data.sender}</div>${data.text}`;
    chatDiv.appendChild(div);
  });
  chatDiv.scrollTop = chatDiv.scrollHeight;
});
</script>

</body>
</html>