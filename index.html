<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Class Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --bg:#eef4fb;
  --sidebar:#dbe9f8;
  --chat:#ffffff;
  --me:#b7d7ff;
  --other:#e6f0ff;
  --accent:#5c8df6;
  --text:#1b1b1b;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}
body{margin:0;height:100vh;display:flex;background:var(--bg);color:var(--text);}

/* SIDEBAR */
#sidebar{width:220px;background:var(--sidebar);padding:10px;overflow:auto;}
#sidebar h3{margin:8px 0;font-size:1rem;}
.user{padding:6px;border-radius:6px;background:#fff;margin-bottom:4px;font-size:.9rem;display:flex;justify-content:space-between;align-items:center;}
.user button{font-size:.7rem;padding:2px 6px;border-radius:6px;background:#ff6b6b;color:#fff;border:none;}

/* CHAT */
#chatWrap{flex:1;display:flex;flex-direction:column;}
#chat{flex:1;padding:10px;overflow:auto;display:flex;flex-direction:column;gap:6px;}
.msg{max-width:75%;padding:8px 12px;border-radius:14px;}
.me{align-self:flex-end;background:var(--me);}
.other{align-self:flex-start;background:var(--other);}
.meta{font-size:.7rem;opacity:.6;margin-bottom:2px;}
#typing{font-size:.7rem;opacity:.6;padding-left:10px;height:16px;}

/* INPUT */
#form{display:flex;gap:6px;padding:8px;background:var(--sidebar);}
#message{flex:1;padding:10px;border-radius:8px;border:1px solid #ccc;}
button{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:600;}

@media(max-width:600px){
  #sidebar{width:140px;font-size:.8rem}
}
</style>
</head>
<body>

<div id="sidebar">
  <h3>Online</h3>
  <div id="online"></div>
</div>

<div id="chatWrap">
  <div id="chat"></div>
  <div id="typing"></div>
  <form id="form">
    <input id="message" placeholder="Type a message‚Ä¶" autocomplete="off">
    <button type="submit">Send</button>
    <button type="button" id="clearBtn">Clear</button>
  </form>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyD9GQMi0v4ItnkJ2uqKtUUQU59DorLrCAg",
  authDomain: "live-chat-3d2c3.firebaseapp.com",
  projectId: "live-chat-3d2c3"
});
const db=firebase.firestore();

/* USER */
let uid=localStorage.getItem("uid");
if(!uid){uid=crypto.randomUUID();localStorage.setItem("uid",uid);}
let name=localStorage.getItem("name");
if(!name){
  name=prompt("Choose a username")||"User";
  localStorage.setItem("name",name);
}
const IS_ADMIN=name.toLowerCase()==="ayla";

/* ONLINE */
const onlineRef=db.collection("online");
onlineRef.doc(uid).set({name});
window.addEventListener("beforeunload",()=>onlineRef.doc(uid).delete());

onlineRef.onSnapshot(s=>{
  online.innerHTML="";
  s.forEach(d=>{
    const u=d.data();
    const div=document.createElement("div");
    div.className="user";
    div.textContent=u.name;
    if(IS_ADMIN && u.name!==name){
      const b=document.createElement("button");
      b.textContent="Kick";
      b.onclick=()=>kick(u.name,d.id);
      div.appendChild(b);
    }
    online.appendChild(div);
  });
});

/* CHAT */
const chatRef=db.collection("messages");
chatRef.orderBy("time").onSnapshot(s=>{
  chat.innerHTML="";
  s.forEach(d=>{
    const m=d.data();
    const div=document.createElement("div");
    div.className="msg "+(m.name===name?"me":"other");
    div.innerHTML=`<div class="meta">${m.name}</div>${m.text}`;
    chat.appendChild(div);
  });
  chat.scrollTop=chat.scrollHeight;
});

/* SEND */
form.onsubmit=e=>{
  e.preventDefault();
  if(!message.value.trim())return;
  chatRef.add({name,text:message.value,time:Date.now()});
  message.value="";
};

/* TYPING */
let typingTimer;
message.oninput=()=>{
  db.collection("typing").doc("now").set({name});
  clearTimeout(typingTimer);
  typingTimer=setTimeout(()=>db.collection("typing").doc("now").delete(),700);
};
db.collection("typing").doc("now").onSnapshot(d=>{
  typing.textContent=d.exists?`${d.data().name} is typing‚Ä¶`:"";
});

/* CLEAR (LOCAL ONLY) */
clearBtn.onclick=()=>{
  chat.innerHTML="";
};

/* KICK */
function kick(n,id){
  const p=prompt("Kick password");
  if(p!=="slay")return;
  onlineRef.doc(id).delete();
  db.collection("kicked").doc(n).set({time:Date.now()});
}
db.collection("kicked").doc(name).onSnapshot(d=>{
  if(d.exists){
    document.body.innerHTML=
    "<div style='height:100vh;display:flex;align-items:center;justify-content:center;background:url(https://images.unsplash.com/photo-1500530855697-b586d89ba3ee) center/cover'><h1 style='color:white'>Timeout Room üå•Ô∏è</h1></div>";
  }
});
</script>
</body>
</html>