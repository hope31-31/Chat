<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Chat Mobile Friendly</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
html, body { margin:0; padding:0; height:100%; font-family:"Georgia",sans-serif; display:flex; flex-direction:column; background:linear-gradient(135deg,#f5c3f5,#b3d9ff,#d7b3ff);}
#container { display:flex; flex:1; flex-direction:row; height:100%; }
#sidebar { width:200px; background:#ffe6f2; display:flex; flex-direction:column; padding:10px; box-sizing:border-box; overflow-y:auto; }
#main { flex:1; display:flex; flex-direction:column; }
header { padding:10px; background:#d7b3ff; display:flex; justify-content:space-between; align-items:center; font-size:1rem; border-bottom:2px solid #ff99cc; }
#username, #avatarInput, #roomSelect, #createPrivate { margin-top:5px; width:100%; padding:5px; border-radius:6px; border:none; }
#chat { flex:1; overflow-y:auto; padding:10px; }
.msg { margin-bottom:8px; padding:6px; border-radius:12px; background:rgba(255,255,255,0.2); max-width:80%; word-wrap:break-word; color:#111; display:flex; align-items:flex-start; }
.me { background:rgba(255,153,204,0.7); margin-left:auto; text-align:right; }
.meta { font-size:0.65rem; opacity:0.7; margin-bottom:2px; display:block; }
.text { flex:1; }
#form { display:flex; padding:6px; background:#b3d9ff; gap:5px; }
#message { flex:1; padding:6px; border-radius:12px; border:none; background:#ffe6f2; color:#111; }
#send, #clearChat, #createPrivate { padding:6px; border:none; border-radius:8px; background:#ff99cc; color:#fff; cursor:pointer; font-weight:bold; font-size:0.9rem;}
#onlineUsers { margin-top:10px; font-size:0.8rem; }
.userEntry { display:flex; justify-content:space-between; margin-bottom:4px; align-items:center; }
.userAvatar { width:25px; height:25px; border-radius:50%; margin-right:4px; object-fit:cover; }
.inviteBtn { background:#d7b3ff; padding:2px 4px; border:none; border-radius:3px; font-size:0.7rem; cursor:pointer; }
.typing { font-style:italic; opacity:0.7; font-size:0.7rem; color:#ff66b3; }

/* iPhone friendly: sidebar collapses on small screens */
@media(max-width:600px){
  #container { flex-direction:column; }
  #sidebar { width:100%; height:auto; flex-direction:row; overflow-x:auto; gap:5px; padding:5px; }
  #sidebar input, #sidebar select, #sidebar button { width:auto; flex:1; font-size:0.8rem; }
  #chat { padding:5px; }
  #form { padding:4px; }
}
</style>
</head>
<body>
<div id="container">
  <div id="sidebar">
    <input id="username" placeholder="Username">
    <input type="text" id="avatarInput" placeholder="Avatar URL (optional)">
    <select id="roomSelect">
      <option value="general">General Room</option>
    </select>
    <button id="createPrivate">Create Private Room</button>
    <div id="onlineUsers"><strong>Online:</strong></div>
  </div>
  <div id="main">
    <header>
      <div>Live Chat</div>
      <button id="clearChat">Clear</button>
    </header>
    <div id="chat"></div>
    <form id="form">
      <input id="message" autocomplete="off" placeholder="Type a message...">
      <button id="send" type="submit">Send</button>
    </form>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// ðŸ”¥ Firebase config
const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_API_KEY",
  authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
  projectId: "YOUR_FIREBASE_PROJECT_ID",
  storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
  messagingSenderId: "YOUR_FIREBASE_MESSAGING_ID",
  appId: "YOUR_FIREBASE_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const sessionId = Math.random().toString(36).substring(2,10);
const chatEl = document.getElementById("chat");
const formEl = document.getElementById("form");
const msgInput = document.getElementById("message");
const userInput = document.getElementById("username");
const avatarInput = document.getElementById("avatarInput");
const roomSelect = document.getElementById("roomSelect");
const clearBtn = document.getElementById("clearChat");
const onlineUsersEl = document.getElementById("onlineUsers");
const createPrivateBtn = document.getElementById("createPrivate");

let currentRoom = 'general';
let onlineUsers = {};

function getAvatar(){ return avatarInput.value || "https://i.imgur.com/67default.png"; }

function addMessage(msg){
  const wrap = document.createElement("div");
  wrap.className = "msg" + (msg.sessionId===sessionId?" me":"");

  const avatarImg = document.createElement("img");
  avatarImg.className="userAvatar";
  avatarImg.src = msg.avatar || "https://i.imgur.com/67default.png";

  const meta = document.createElement("div");
  meta.className="meta";
  meta.textContent = msg.name + " â€¢ " + new Date(msg.time).toLocaleTimeString();

  const text = document.createElement("div");
  text.className="text";
  text.textContent = msg.text;

  wrap.appendChild(avatarImg);
  const content = document.createElement("div");
  content.appendChild(meta);
  content.appendChild(text);
  wrap.appendChild(content);

  chatEl.appendChild(wrap);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function updateOnlineUsers(){
  onlineUsersEl.innerHTML="<strong>Online:</strong><br>";
  Object.values(onlineUsers).forEach(user=>{
    const entry=document.createElement("div");
    entry.className="userEntry";

    const avatarImg=document.createElement("img");
    avatarImg.className="userAvatar";
    avatarImg.src=user.avatar || "https://i.imgur.com/67default.png";

    const nameSpan=document.createElement("span");
    nameSpan.textContent=user.name;

    const inviteBtn=document.createElement("button");
    inviteBtn.className="inviteBtn";
    inviteBtn.textContent="Invite";
    inviteBtn.onclick=()=>alert("Invite "+user.name+" to room: "+currentRoom);

    entry.appendChild(avatarImg);
    entry.appendChild(nameSpan);
    entry.appendChild(inviteBtn);
    onlineUsersEl.appendChild(entry);
  });
}

// Listen for messages
db.collection("messages").orderBy("time").onSnapshot(snapshot=>{
  chatEl.innerHTML="";
  snapshot.forEach(doc=>{
    const msg=doc.data();
    if(msg.room===currentRoom) addMessage(msg);
  });
});

// Listen for online users
db.collection("online").onSnapshot(snapshot=>{
  onlineUsers={};
  snapshot.forEach(doc=>{
    const user=doc.data();
    if(user.room===currentRoom) onlineUsers[user.sessionId]=user;
  });
  updateOnlineUsers();
});

// Send message
formEl.addEventListener("submit", e=>{
  e.preventDefault();
  const text = msgInput.value.trim();
  if(!text) return;
  const msg={name:userInput.value||"anon", text, time:Date.now(), sessionId, room:currentRoom, avatar:getAvatar()};
  db.collection("messages").add(msg);
  msgInput.value="";
});

// Local clear chat
clearBtn.addEventListener("click",()=>{ chatEl.innerHTML=""; });

// Update presence every 5s
function updatePresence(){
  db.collection("online").doc(sessionId).set({name:userInput.value||"anon", sessionId, room:currentRoom, avatar:getAvatar()});
  setTimeout(updatePresence,5000);
}
updatePresence();

// Create private room
createPrivateBtn.addEventListener("click", ()=>{
  const roomName=prompt("Enter private room name:");
  if(!roomName) return;
  roomSelect.innerHTML += `<option value="${roomName}">${roomName}</option>`;
  roomSelect.value=roomName;
  currentRoom=roomName;
});

// Switch rooms
roomSelect.addEventListener("change", ()=>{
  currentRoom=roomSelect.value;
});

</script>
</body>
</html>